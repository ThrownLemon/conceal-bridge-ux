{"id":"conceal-bridge-ux-38j","title":"Add skip navigation link for keyboard users","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-28T04:43:30.495654+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:30.495654+10:00"}
{"id":"conceal-bridge-ux-3mp","title":"Verify color contrast ratios meet WCAG AA","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T04:43:17.873824+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:17.873824+10:00"}
{"id":"conceal-bridge-ux-3r7","title":"Add loading state announcements for screen readers","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T04:43:22.557889+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:22.557889+10:00"}
{"id":"conceal-bridge-ux-61i","title":"Add ARIA live regions for dynamic content","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T04:43:11.190405+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:11.190405+10:00"}
{"id":"conceal-bridge-ux-643","title":"Implement focus trap in wallet modal","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T04:43:34.759655+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:34.759655+10:00"}
{"id":"conceal-bridge-ux-77l","title":"Associate form validation errors with inputs","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T04:43:47.116203+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:47.116203+10:00"}
{"id":"conceal-bridge-ux-7hp","title":"Implement EVM ↔ EVM Swaps","description":"## Context / Current State\n\n- The Home flow explicitly blocks direct EVM-to-EVM swaps:\n  - “Direct EVM-to-EVM swaps are not supported yet…” in [`HomePage.go()`](conceal-bridge-ux/src/app/pages/home/home.page.ts:425).\n- The network selector enforces “exactly one side is CCX”:\n  - see the constraint in [`HomePage.normalizeNetworks()`](conceal-bridge-ux/src/app/pages/home/home.page.ts:359).\n- Current supported EVM networks are:\n  - Ethereum (1), BSC (56), Polygon (137) via [`EVM_NETWORKS`](conceal-bridge-ux/src/app/core/evm-networks.ts:11).\n- Current swap routes are CCX-centric only:\n  - `/swap/:direction/:network` with directions `'ccx-to-evm' | 'evm-to-ccx'` in [`routes`](conceal-bridge-ux/src/app/app.routes.ts:3).\n\n## Goal\n\nAdd support for **EVM ↔ EVM** swap flows in the UI **without breaking** the existing CCX ↔ EVM bridge flows.\n\nUsers should be able to select an EVM network on both sides (e.g. Ethereum → Polygon), connect a wallet, and complete a swap with clear statuses, safe validation, and predictable error handling.\n\n## Non-Goals\n\n- Implementing a full DEX aggregator in the frontend.\n- Performing “real cross-chain bridging” on-chain without backend support.\n- Supporting non-EVM chains.\n- Adding a full “bridge explorer” / account history (separate spec).\n\n## Assumptions / Dependencies\n\nAt least one of the following must be true (to be decided with backend team):\n\n1. **Backend-driven EVM↔EVM bridging**\n   - Backend exposes idempotent endpoints for quote + execution + status, similar to current bridge endpoints in [`BridgeApiService`](conceal-bridge-ux/src/app/core/bridge-api.service.ts:13).\n\nOR\n\n2. **Frontend-driven EVM↔EVM routing**\n   - The UI integrates an external bridging/DEX SDK, and the backend is only used for analytics/optional support.\n   - This requires careful CSP updates (see [`security_headers_and_csp.md`](conceal-bridge-ux/security_headers_and_csp.md:41)).\n\nThis spec assumes (1) initially because it aligns with the current architecture (backend-driven swap state polling via [`SwapPage.startPolling()`](conceal-bridge-ux/src/app/pages/swap/swap.page.ts:845)).\n\n## UX / Product Requirements\n\n1. **Network selector must allow EVM↔EVM**\n   - Remove/adjust the “one side must be CCX” enforcement (currently in [`HomePage.normalizeNetworks()`](conceal-bridge-ux/src/app/pages/home/home.page.ts:359)).\n2. **New swap direction**\n   - Introduce a third swap direction: `evm-to-evm`.\n3. **Wallet UX**\n   - Continue using existing wallet connect and network switching behavior:\n     - connect modal: [`WalletButtonComponent`](conceal-bridge-ux/src/app/shared/wallet/wallet-button.component.ts:309)\n     - network switching: [`EvmWalletService.ensureChain()`](conceal-bridge-ux/src/app/core/evm-wallet.service.ts:205)\n4. **Error-handling consistency**\n   - Follow existing conventions (`pageError` vs `statusMessage`) from [`SwapPage`](conceal-bridge-ux/src/app/pages/swap/swap.page.ts:445) and guidance in [`error_handling.md`](conceal-bridge-ux/docs/error_handling.md:30).\n5. **Safety \u0026 clarity**\n   - Must show from/to networks clearly at all times.\n   - Must not allow double-submission / double-execution.\n\n## API Contract (Proposed)\n\n\u003e Exact naming may differ; the goal is to define the minimum needed primitives.\n\n### A) Quote endpoint\n\n- `POST /{network}/api/evm/evm/quote`\n- Request:\n  - `fromChainId`, `toChainId`\n  - `fromToken`, `toToken` (addresses or canonical identifiers)\n  - `amount` (string/decimal or integer in smallest units)\n  - `toAddress`\n- Response:\n  - `success: boolean`\n  - `quoteId`\n  - `expectedAmountOut`\n  - `feesBreakdown`\n  - `expiresAt`\n  - optional: transaction request template (to be signed)\n\n### B) Execute endpoint\n\n- `POST /{network}/api/evm/evm/exec`\n- Request:\n  - `quoteId`\n  - `userTxHash` (if user must send an on-chain tx)\n  - optional: `email` (if you keep parity with current init flows)\n- Response:\n  - `success: boolean`\n  - `paymentId` (or similar stable tracking id)\n\n### C) Status endpoint (polling)\n\n- `POST /{network}/api/evm/evm/tx`\n- Request:\n  - `paymentId`\n- Response:\n  - `result: boolean`\n  - `txdata` with:\n    - `sourceTxHash`\n    - `destinationTxHash`\n    - `fromChainId`, `toChainId`\n    - `fromAmount`, `toAmount`\n\n**Rule:** status endpoint must be safe/idempotent for polling retry (align with polling design in [`SwapPage.startPolling()`](conceal-bridge-ux/src/app/pages/swap/swap.page.ts:845)).\n\n## UI Flow (Proposed)\n\n1. **Home**\n   - Allow selection of EVM on both sides.\n   - When submitting, route to a new swap route:\n     - `/swap/evm-to-evm/\u003cfromNetworkKey\u003e-to-\u003ctoNetworkKey\u003e` (example)\n   - Alternatively, extend route params (recommended):\n     - `/swap/:direction/:from/:to`\n\n2. **Swap Page**\n   - New mode `evm-to-evm` with steps similar to current flows:\n     - Step 0: Validate input (recipient address, amount)\n     - Step 1: Quote + user approval (show fees, expected output)\n     - Step 2: User signs/sends tx (if required)\n     - Step 3: Poll status until completion\n\n## Validation / Security Requirements\n\n- Address validation uses viem `isAddress` (pattern already used in [`SwapPage`](conceal-bridge-ux/src/app/pages/swap/swap.page.ts:9)).\n- Must enforce:\n  - min/max amounts per backend quote response (do not guess in UI).\n  - slippage or “price protection” rules (separate spec if DEX-like).\n- Do not store sensitive swap details in localStorage (align with rules in [`security.md`](conceal-bridge-ux/docs/security.md:1)).\n\n## Observability\n\nLog key events via the planned logging system (see [`observability_and_client_logging.md`](conceal-bridge-ux/observability_and_client_logging.md:1)):\n\n- `swap.evmToEvm.quote.start|success|error`\n- `swap.evmToEvm.exec.start|success|error`\n- `swap.evmToEvm.polling.timeout|recovered|completed`\n\n## Testing Plan\n\n- Unit/component tests:\n  - Ensure Home allows EVM↔EVM selection and routes correctly.\n  - Ensure Swap page validates addresses/amounts and shows correct step transitions.\n- E2E:\n  - Use the approach in [`e2e_testing.md`](conceal-bridge-ux/e2e_testing.md:45):\n    - mock backend quote/exec/status endpoints\n    - inject fake wallet provider\n    - verify UI reaches completion via polling\n\n## Risks / Considerations\n\n- EVM↔EVM “swap” may require bridging + liquidity routing; complexity depends on backend.\n- UI must avoid confusing EVM↔EVM swaps with the CCX bridge product promise.\n- Any new third-party SDK will impact CSP and must be allowlisted per [`security_headers_and_csp.md`](conceal-bridge-ux/security_headers_and_csp.md:41).\n\n## Implementation Steps (Work Breakdown)\n\n1. Define route shape changes (new params) in [`app.routes.ts`](conceal-bridge-ux/src/app/app.routes.ts:3).\n2. Update Home network selection logic in [`HomePage.normalizeNetworks()`](conceal-bridge-ux/src/app/pages/home/home.page.ts:359) and submit logic in [`HomePage.go()`](conceal-bridge-ux/src/app/pages/home/home.page.ts:425).\n3. Add new UI path in [`SwapPage`](conceal-bridge-ux/src/app/pages/swap/swap.page.ts:400) for `evm-to-evm`.\n4. Add backend API methods to [`BridgeApiService`](conceal-bridge-ux/src/app/core/bridge-api.service.ts:13) (or a new dedicated service) for quote/exec/status.\n5. Add tests (unit + E2E per [`e2e_testing.md`](conceal-bridge-ux/e2e_testing.md:1)).","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-20T12:50:00.102320509Z","updated_at":"2025-12-28T03:03:28.654087+10:00","deleted_at":"2025-12-28T03:03:28.654087+10:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"conceal-bridge-ux-a77","title":"Add automated accessibility testing to CI/CD","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-28T04:43:26.657272+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:26.657272+10:00"}
{"id":"conceal-bridge-ux-edz","title":"Implement focus trap in transaction history sidebar","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T04:43:38.816519+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:38.816519+10:00"}
{"id":"conceal-bridge-ux-fq9","title":"Add ARIA landmarks to main layout sections","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T04:43:42.756611+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:42.756611+10:00"}
{"id":"conceal-bridge-ux-g2u","title":"Fix dropdown trigger ARIA role and attributes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T04:43:15.178479+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:15.178479+10:00"}
{"id":"conceal-bridge-ux-khn","title":"Verify and improve focus indicators","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T04:43:51.440491+10:00","created_by":"travis","updated_at":"2025-12-28T04:43:51.440491+10:00"}
