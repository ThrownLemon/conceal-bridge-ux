{"id":"conceal-bridge-ux-8sc","title":"Add test coverage thresholds to Vitest config","description":"## Problem\nNo coverage thresholds are enforced in CI. Tests run but don't fail if coverage drops below acceptable levels.\n\n## Acceptance Criteria\n- [ ] Add coverage configuration to `vitest.config.ts`\n- [ ] Set minimum thresholds:\n  - Statements: 70%\n  - Branches: 60%\n  - Functions: 70%\n  - Lines: 70%\n- [ ] Configure coverage reporter (lcov, text)\n- [ ] Update CI workflow to fail on coverage below threshold\n- [ ] Add coverage badge to README (optional)\n\n## Files Affected\n- `vitest.config.ts`\n- `.github/workflows/deploy.yml`\n\n## Technical Notes\n- Use `@vitest/coverage-v8` or `@vitest/coverage-istanbul`\n- Consider per-file thresholds for critical services\n- Start with achievable thresholds, increase over time","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-28T20:24:44.849481+10:00","created_by":"travis","updated_at":"2025-12-28T20:24:44.849481+10:00","dependencies":[{"issue_id":"conceal-bridge-ux-8sc","depends_on_id":"conceal-bridge-ux-9ni","type":"blocks","created_at":"2025-12-28T20:25:43.381224+10:00","created_by":"daemon"},{"issue_id":"conceal-bridge-ux-8sc","depends_on_id":"conceal-bridge-ux-k8n","type":"blocks","created_at":"2025-12-28T20:25:43.504868+10:00","created_by":"daemon"}]}
{"id":"conceal-bridge-ux-9ni","title":"Add unit tests for EvmWalletService","description":"## Problem\nThe `EvmWalletService` has no unit tests. This is a critical service handling:\n- Wallet connections (MetaMask, Trust, Binance)\n- Chain switching via `ensureChain()`\n- Transaction sending\n- Provider state management\n- Disconnect persistence\n\n## Acceptance Criteria\n- [ ] Create `evm-wallet.service.spec.ts`\n- [ ] Test `connect()` with mocked providers\n- [ ] Test `connectWith()` for each connector type\n- [ ] Test `disconnect()` and localStorage flag\n- [ ] Test `ensureChain()` network switching\n- [ ] Test `sendNativeTransaction()` happy path\n- [ ] Test error handling for failed connections\n- [ ] Test `hydrate()` silent reconnection logic\n- [ ] Achieve \u003e80% coverage for this service\n\n## Files Affected\n- `src/app/core/evm-wallet.service.ts`\n- New: `src/app/core/evm-wallet.service.spec.ts`\n\n## Technical Notes\n- Mock `window.ethereum` and provider objects\n- Use Vitest for testing\n- Consider using `vi.mock()` for Viem imports\n- Test both success and failure scenarios","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T20:24:39.753226+10:00","created_by":"travis","updated_at":"2025-12-28T20:24:39.753226+10:00"}
{"id":"conceal-bridge-ux-k8n","title":"Add unit tests for TransactionHistoryService","description":"## Problem\nThe `TransactionHistoryService` has no unit tests. This service manages local storage of transaction history which is important for user experience.\n\n## Acceptance Criteria\n- [ ] Create `transaction-history.service.spec.ts`\n- [ ] Test storing new transactions\n- [ ] Test retrieving transaction history\n- [ ] Test localStorage persistence\n- [ ] Test handling of corrupted localStorage data\n- [ ] Test transaction limit/pruning if applicable\n- [ ] Test filtering by network/direction\n\n## Files Affected\n- `src/app/core/transaction-history.service.ts`\n- New: `src/app/core/transaction-history.service.spec.ts`\n\n## Technical Notes\n- Mock localStorage for testing\n- Test edge cases (empty storage, malformed JSON)\n- Verify data structure matches `StoredTransaction` interface","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T20:25:27.183965+10:00","created_by":"travis","updated_at":"2025-12-28T20:25:27.183965+10:00"}
{"id":"conceal-bridge-ux-nza","title":"Add JSDoc comments for public service APIs","description":"## Problem\nCore services lack JSDoc documentation for public methods, making it harder for developers to understand expected inputs/outputs without reading implementation.\n\n## Acceptance Criteria\n- [ ] Document `EvmWalletService` public methods\n- [ ] Document `BridgeApiService` public methods\n- [ ] Document `TransactionHistoryService` public methods\n- [ ] Include @param, @returns, @throws annotations\n- [ ] Include usage examples where helpful\n- [ ] Document signal properties with their purpose\n\n## Files Affected\n- `src/app/core/evm-wallet.service.ts`\n- `src/app/core/bridge-api.service.ts`\n- `src/app/core/transaction-history.service.ts`\n\n## Example Format\n```typescript\n/**\n * Connects to an EVM wallet using the specified connector.\n * @param connector - The wallet connector type ('injected' | 'trust' | 'binance')\n * @returns Promise that resolves when connected\n * @throws Error if wallet extension is not installed\n * @example\n * await walletService.connectWith('injected');\n */\nasync connectWith(connector: WalletConnector): Promise\u003cvoid\u003e\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T20:25:13.262264+10:00","created_by":"travis","updated_at":"2025-12-28T20:25:13.262264+10:00"}
{"id":"conceal-bridge-ux-s0a","title":"Expand SwapPage tests beyond security validation","description":"## Problem\nCurrent `swap.page.spec.ts` only tests security-related input validation. Business logic, state transitions, and user flows are not tested.\n\n## Acceptance Criteria\n- [ ] Test CCX→wCCX flow state transitions (step 0 → 1 → 2)\n- [ ] Test wCCX→CCX flow state transitions\n- [ ] Test form submission and API calls\n- [ ] Test wallet connection integration\n- [ ] Test polling mechanism and status updates\n- [ ] Test error states and user feedback\n- [ ] Test transaction history recording\n- [ ] Test network switching requirements\n- [ ] Achieve \u003e70% coverage for SwapPage\n\n## Files Affected\n- `src/app/pages/swap/swap.page.spec.ts`\n\n## Technical Notes\n- Mock `BridgeApiService` responses for different states\n- Mock `EvmWalletService` for wallet interactions\n- Test computed signals update correctly\n- Test ARIA live region announcements\n- Use `fakeAsync` for polling tests","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T20:25:04.543337+10:00","created_by":"travis","updated_at":"2025-12-28T20:25:04.543337+10:00","dependencies":[{"issue_id":"conceal-bridge-ux-s0a","depends_on_id":"conceal-bridge-ux-ttu","type":"blocks","created_at":"2025-12-28T20:25:43.250016+10:00","created_by":"daemon"}]}
{"id":"conceal-bridge-ux-srz","title":"Add exponential backoff for API error retries","description":"## Problem\nThe polling mechanism in `checkSwapState()` and other API calls don't implement client-side rate limiting or exponential backoff after errors.\n\n## Acceptance Criteria\n- [ ] Implement exponential backoff utility/service\n- [ ] Apply to `checkSwapState()` polling in SwapPage\n- [ ] Configure max retries (e.g., 5)\n- [ ] Configure base delay (e.g., 1000ms)\n- [ ] Configure max delay cap (e.g., 30000ms)\n- [ ] Add jitter to prevent thundering herd\n- [ ] Preserve existing polling interval for success cases\n- [ ] Add tests for backoff logic\n\n## Files Affected\n- `src/app/pages/swap/swap.page.ts`\n- New: `src/app/core/utils/backoff.ts` (or similar)\n\n## Technical Notes\n- Consider using `exponential-backoff` npm package (already in node_modules)\n- Or implement custom RxJS operator with `retryWhen`\n- Formula: `min(maxDelay, baseDelay * 2^attempt + jitter)`\n- Reset backoff on successful response","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T20:24:55.731352+10:00","created_by":"travis","updated_at":"2025-12-28T20:24:55.731352+10:00"}
{"id":"conceal-bridge-ux-ttu","title":"Refactor SwapPage into smaller components","description":"## Problem\nThe SwapPage component is 44KB and violates the 500-line guideline. It handles too many concerns:\n- Form management (2 forms)\n- Multi-step wizard logic\n- Polling state machine\n- Two swap directions (CCX→wCCX, wCCX→CCX)\n- Wallet integration\n- Transaction history\n- Error handling\n\n## Acceptance Criteria\n- [ ] Extract `SwapFormService` for form creation and validation\n- [ ] Extract `SwapStateService` for step/polling state machine\n- [ ] Create step components: `SwapStep0Component`, `SwapStep1Component`, `SwapStep2Component`\n- [ ] Consider strategy pattern for CCX→wCCX vs wCCX→CCX directions\n- [ ] Each extracted file should be under 500 lines\n- [ ] All existing tests must pass\n- [ ] No regression in functionality\n\n## Files Affected\n- `src/app/pages/swap/swap.page.ts` (primary)\n- New files to create in `src/app/pages/swap/`\n\n## Technical Notes\n- Maintain OnPush change detection\n- Keep signal-based state management\n- Preserve accessibility features (ARIA live regions)\n- Ensure lazy loading still works","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T20:24:21.09114+10:00","created_by":"travis","updated_at":"2025-12-28T20:24:21.09114+10:00"}
{"id":"conceal-bridge-ux-z5l","title":"Add global error boundary/handler","description":"## Problem\nNo global error boundary exists to catch and gracefully handle uncaught errors. While `provideBrowserGlobalErrorListeners()` is configured, there's no user-facing error UI or reporting.\n\n## Acceptance Criteria\n- [ ] Create `ErrorBoundaryService` or similar\n- [ ] Implement global error handler that catches uncaught exceptions\n- [ ] Display user-friendly error message (not stack traces)\n- [ ] Add 'Reload' or 'Go Home' recovery options\n- [ ] Log errors for debugging (console in dev, optional reporting in prod)\n- [ ] Handle chunk loading errors (lazy load failures)\n- [ ] Preserve accessibility in error state\n\n## Files Affected\n- `src/app/app.config.ts`\n- New: `src/app/core/error-handler.service.ts`\n- New: `src/app/shared/components/error-boundary/`\n\n## Technical Notes\n- Extend Angular's `ErrorHandler` class\n- Consider integration with error reporting service (Sentry, etc.) - optional\n- Handle `ChunkLoadError` for failed lazy loads\n- Don't expose sensitive error details to users","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-28T20:25:16.699022+10:00","created_by":"travis","updated_at":"2025-12-28T20:25:16.699022+10:00"}
